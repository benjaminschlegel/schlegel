setwd("C:\\Users\\Benjamin Schlegel\\OneDrive - uzh.ch\\01_UZH\\06_R_Book\\data\\selects")
library(dplyr)

selects2015 = haven::read_dta("726_Selects2015_PES_Data_v1.03.dta") %>%
  select(gender, age = birthyear, canton,
         education = educ_r, participation = f11100r,
         vote_choice = f11800main7,
         political_interest = f10100,
         lr_self = f15200, knowscale,
         opinion_social_expenses = f15420,
         opinion_eu_membership = f15430,
         opinion_foreigners_swiss_equal = f15440,
         opinion_environment_economy = f15470,
         opinion_nuclear_energy = f15490,
         opinion_high_income_taxes = f15480,
         weight_total) %>% 
  mutate(gender = factor(gender, labels = c('male','female')),
         age = 2015 - ifelse(age == -9, NA, age),
         canton = factor(canton, 
                         labels = c('Zurich','Bern','Luzern','Uri','Schwyz','Obwalden',
                                    'Niedwalden','Glarus','Zug','Fribourg','Solothurn',
                                    'Basel-Stadt','Basel-Landschaft','Schffhausen',
                                    'Appenzell Ausserrhoden','Appenzell Innerrhoden',
                                    'St. Gallen','Grisons','Aargau','Thurgau','Ticino',
                                    'Vaud','Valais','Neuchatel','Geneva','Jura')),
         education = factor(recode(as.character(education), 
                       '1' = 'no graduation',
                       '2' = 'no graduation',
                       '3' = 'compulsory schooling',
                       '4' = 'apprenticeship',
                       '5' = 'apprenticeship',
                       '6' = 'diploma or trading school',
                       '7' = 'diploma or trading school',
                       '8' = '(vocational) matura',
                       '9' = '(vocational) matura',
                       '10' = 'higher vocational degree',
                       '11' = 'HF',
                       '12' = '(applied/teacher) university',
                       '13' = '(applied/teacher) university',
                       .default = NA_character_),
                       levels = c('no graduation',
                                  'compulsory schooling',
                                  'apprenticeship',
                                  'diploma or trading school',
                                  '(vocational) matura',
                                  'higher vocational degree',
                                  'HF','(applied/teacher) university')),
         participation = ifelse(participation > 1, NA, participation),
         vote_choice = factor(ifelse(vote_choice == 9, NA, vote_choice),
                              labels = c("SVP","FDP","BDP","CVP","GLP","SP","GPS","other")),
         political_interest = factor(ifelse(political_interest > 8, NA, political_interest),
                                     labels = c("very interested", "rather interested", "rather not interested", "not interested at all")),
         lr_self = ifelse(lr_self > 10, NA, lr_self),
         knowscale = ifelse(knowscale == -1, NA, knowscale),
         opinion_eu_membership = factor(ifelse(opinion_eu_membership > 5, NA, opinion_eu_membership),
                                        labels = c('Strongly for EU entry','Rather for EU entry',
                                                   'Neither nor', 'Rather in favour to stay out',
                                                   'Strongly in favour to stay out')),
         opinion_foreigners_swiss_equal = factor(ifelse(opinion_foreigners_swiss_equal > 5, NA, opinion_foreigners_swiss_equal),
                                        labels = c('Strongly for equal chances','Rather for equal chances',
                                                   'Neither nor', 'Rather for better chances for Swiss',
                                                   'Strongly for better chances for Swiss')),
         opinion_environment_economy = factor(ifelse(opinion_environment_economy > 5, NA, opinion_environment_economy),
                                                 labels = c('Strongly for environmental protection','Rather for environmental protection',
                                                            'Neither nor', 'Rather for economic growth',
                                                            'Strongly for economic growth')),
         opinion_nuclear_energy = factor(ifelse(opinion_nuclear_energy > 5, NA, opinion_nuclear_energy),
                                              labels = c('Strongly for nuclear energy','Rather for nuclear energy',
                                                         'Neither nor', 'Rather against nuclear energy',
                                                         'Strongly against nuclear energy')),
         opinion_social_expenses = factor(ifelse(opinion_social_expenses > 5, NA, opinion_social_expenses),
                                         labels = c('Strongly for decrease','Rather for decrease',
                                                    'Neither nor', 'Rather for increase',
                                                    'Strongly for increase')),
         opinion_high_income_taxes = factor(ifelse(opinion_high_income_taxes > 5, NA, opinion_high_income_taxes),
                                          labels = c('Strongly for increase','Rather for increase',
                                                     'Neither nor', 'Rather for decrease',
                                                     'Strongly for decrease'))) %>% as.data.frame()

saveRDS(selects2015, "../selects2015.Rds")
